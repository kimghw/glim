<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ouster ÎùºÏù¥Îã§ Î∂ÑÏÑù ÎåÄÏãúÎ≥¥Îìú</title>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #6B8DD6 0%, #8E37D7 100%);
            padding: 20px;
            min-height: 100vh;
            color: #1a1a1a;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.98);
            padding: 35px 40px;
            border-radius: 24px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.08);
            margin-bottom: 24px;
            backdrop-filter: blur(10px);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left h1 {
            color: #1a1a1a;
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .subtitle {
            color: #6B8DD6;
            font-size: 0.95em;
            font-weight: 500;
        }

        .header-right {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .time-badge {
            background: linear-gradient(135deg, #6B8DD6, #8E37D7);
            color: white;
            padding: 10px 20px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.98);
            padding: 28px;
            border-radius: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.06);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            cursor: move;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.12);
        }

        .card.collapsed .card-body {
            display: none;
        }

        .card.collapsed {
            padding: 20px 28px;
        }

        .card.sortable-ghost {
            opacity: 0.4;
        }

        .card.sortable-drag {
            opacity: 0.8;
            transform: rotate(2deg);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            user-select: none;
        }

        .card.collapsed .card-header {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .card-header-left {
            display: flex;
            align-items: center;
        }

        .card-header-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .collapse-btn {
            width: 28px;
            height: 28px;
            border-radius: 8px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            cursor: pointer;
            font-size: 14px;
        }

        .collapse-btn:hover {
            background: #e0e0e0;
        }

        .drag-handle {
            width: 28px;
            height: 28px;
            border-radius: 8px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: grab;
            font-size: 16px;
            transition: all 0.2s ease;
        }

        .drag-handle:hover {
            background: #e0e0e0;
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #6B8DD6, #8E37D7);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 14px;
            font-size: 20px;
        }

        .card h2 {
            color: #1a1a1a;
            font-size: 1.1em;
            font-weight: 700;
            letter-spacing: -0.3px;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 14px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.8em;
            letter-spacing: 0.3px;
            text-transform: uppercase;
        }

        .status-online {
            background: #E8F5E9;
            color: #2E7D32;
        }

        .status-offline {
            background: #FFEBEE;
            color: #C62828;
        }

        .status-recording {
            background: #FFF3E0;
            color: #E65100;
            animation: pulse-glow 2s infinite;
        }

        @keyframes pulse-glow {
            0%, 100% {
                opacity: 1;
                box-shadow: 0 0 0 0 rgba(230, 81, 0, 0.4);
            }
            50% {
                opacity: 0.85;
                box-shadow: 0 0 0 8px rgba(230, 81, 0, 0);
            }
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 0;
            border-bottom: 1px solid #f5f5f5;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 500;
            color: #757575;
            font-size: 0.9em;
        }

        .info-value {
            color: #1a1a1a;
            font-weight: 600;
            font-size: 0.95em;
        }

        /* ÏõêÌòï ÌîÑÎ°úÍ∑∏Î†àÏä§ Î∞î */
        .progress-circle {
            position: relative;
            width: 140px;
            height: 140px;
            margin: 24px auto;
        }

        .progress-circle svg {
            transform: rotate(-90deg);
        }

        .progress-circle circle {
            fill: none;
            stroke-width: 10;
        }

        .progress-bg {
            stroke: #f0f0f0;
        }

        .progress-bar {
            stroke: url(#gradient);
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s ease;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .progress-value {
            font-size: 32px;
            font-weight: 800;
            color: #6B8DD6;
            display: block;
        }

        .progress-label {
            font-size: 11px;
            color: #999;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Î≤ÑÌäº Ïä§ÌÉÄÏùº */
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 14px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin: 6px;
            font-family: 'Inter', sans-serif;
            letter-spacing: 0.3px;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .btn:active:not(:disabled) {
            transform: translateY(0);
        }

        .btn-primary {
            background: linear-gradient(135deg, #6B8DD6, #8E37D7);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #66BB6A, #43A047);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #EF5350, #E53935);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #FFA726, #FB8C00);
            color: white;
        }

        .btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }

        /* ÏûÖÎ†• ÌïÑÎìú */
        input[type="text"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 14px 16px;
            margin: 8px 0;
            border: 2px solid #f0f0f0;
            border-radius: 12px;
            font-size: 0.95em;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
            background: #fafafa;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #6B8DD6;
            background: white;
            box-shadow: 0 0 0 4px rgba(107, 141, 214, 0.1);
        }

        /* Ï≤¥ÌÅ¨Î∞ïÏä§ Ïä§ÌÉÄÏùº */
        .checkbox-label {
            display: flex;
            align-items: center;
            margin: 14px 0;
            cursor: pointer;
            padding: 12px;
            border-radius: 12px;
            transition: background 0.2s ease;
        }

        .checkbox-label:hover {
            background: #f8f9fa;
        }

        .checkbox-label input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            cursor: pointer;
            accent-color: #6B8DD6;
        }

        /* ÌååÏùº Î¶¨Ïä§Ìä∏ */
        .file-list {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 8px;
        }

        .file-list::-webkit-scrollbar {
            width: 6px;
        }

        .file-list::-webkit-scrollbar-track {
            background: #f0f0f0;
            border-radius: 10px;
        }

        .file-list::-webkit-scrollbar-thumb {
            background: #6B8DD6;
            border-radius: 10px;
        }

        .file-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            padding: 20px;
            margin: 12px 0;
            border-radius: 16px;
            border-left: 4px solid #6B8DD6;
            transition: all 0.3s ease;
        }

        .file-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
        }

        .file-name {
            font-weight: 700;
            color: #1a1a1a;
            font-size: 1.05em;
            margin-bottom: 10px;
            letter-spacing: -0.3px;
        }

        .file-info {
            color: #757575;
            font-size: 0.85em;
            margin: 4px 0;
            font-weight: 500;
        }

        .file-actions {
            margin-top: 14px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .file-actions .btn {
            margin: 0;
            padding: 10px 18px;
            font-size: 0.85em;
        }

        /* Topics Î¶¨Ïä§Ìä∏ */
        .topics-list {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 12px;
            max-height: 220px;
            overflow-y: auto;
            font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
            font-size: 0.85em;
        }

        .topics-list div {
            padding: 8px;
            border-bottom: 1px solid #e9ecef;
            color: #495057;
            font-weight: 500;
        }

        .topics-list div:last-child {
            border-bottom: none;
        }

        /* Î™®Îã¨ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(26, 26, 26, 0.6);
            backdrop-filter: blur(8px);
            overflow: auto;
        }

        .modal-content {
            background: white;
            margin: 40px auto;
            padding: 0;
            border-radius: 24px;
            width: 90%;
            max-width: 800px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 28px 32px;
            background: linear-gradient(135deg, #6B8DD6, #8E37D7);
            color: white;
            border-radius: 24px 24px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-size: 1.4em;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .modal-body {
            padding: 32px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .close {
            color: white;
            font-size: 32px;
            font-weight: 300;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .close:hover {
            transform: scale(1.1);
        }

        .form-section {
            background: #f8f9fa;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .form-section h3 {
            margin: 0 0 20px 0;
            color: #6B8DD6;
            font-weight: 700;
            font-size: 1.1em;
            letter-spacing: -0.3px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #1a1a1a;
            font-size: 0.9em;
        }

        /* Î©îÏãúÏßÄ ÏïåÎ¶º */
        #message {
            position: fixed;
            top: 24px;
            right: 24px;
            padding: 18px 28px;
            border-radius: 16px;
            color: white;
            font-weight: 600;
            display: none;
            z-index: 1001;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            animation: slideIn 0.3s ease;
            backdrop-filter: blur(10px);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        #message.success {
            background: linear-gradient(135deg, #66BB6A, #43A047);
        }

        #message.error {
            background: linear-gradient(135deg, #EF5350, #E53935);
        }

        /* ÏûêÎèô ÏÉàÎ°úÍ≥†Ïπ® ÌëúÏãú */
        .auto-refresh {
            text-align: center;
            color: rgba(255,255,255,0.7);
            font-size: 0.85em;
            margin-top: 20px;
            font-weight: 500;
        }

        /* Ï∫°Ï≤ò Ïù¥ÎØ∏ÏßÄ Ïä¨ÎùºÏù¥Îçî */
        .image-slider {
            position: relative;
            width: 100%;
            margin-top: 16px;
        }

        .slider-image {
            width: 100%;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            display: none;
        }

        .slider-image.active {
            display: block;
        }

        .slider-controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 12px;
        }

        .slider-btn {
            background: linear-gradient(135deg, #6B8DD6, #8E37D7);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9em;
        }

        .slider-btn:hover {
            opacity: 0.9;
        }

        .slider-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .slider-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 12px;
        }

        .slider-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ddd;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .slider-dot.active {
            background: linear-gradient(135deg, #6B8DD6, #8E37D7);
            transform: scale(1.3);
        }

        .slider-label {
            text-align: center;
            margin-top: 8px;
            font-weight: 600;
            color: #6B8DD6;
            font-size: 0.95em;
        }

        .btn-secondary {
            background: #e9ecef;
            color: #495057;
        }

        .btn-info {
            background: linear-gradient(135deg, #4FC3F7, #29B6F6);
            color: white;
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }

            .header-content {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }

            .card {
                padding: 20px;
            }

            .file-actions {
                flex-direction: column;
            }

            .file-actions .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="header-left">
                    <h1>Your Analytics</h1>
                    <p class="subtitle">Ouster LiDAR Monitoring Dashboard</p>
                </div>
                <div class="header-right">
                    <div class="time-badge" id="last-update">Loading...</div>
                </div>
            </div>
        </div>

        <div class="grid" id="dashboard-grid">
            <!-- ÏÑºÏÑú ÏÉÅÌÉú -->
            <div class="card" data-card-id="sensor-status">
                <div class="card-header">
                    <div class="card-header-left">
                        <div class="card-icon">
                            <svg width="24" height="24" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <!-- ÎùºÏù¥Îã§ ÏÑºÏÑú Î™®Ïñë -->
                                <rect x="20" y="60" width="60" height="30" rx="3" fill="white" opacity="0.9"/>
                                <rect x="15" y="35" width="70" height="25" rx="2" fill="white" opacity="0.95"/>
                                <circle cx="50" cy="47" r="20" fill="white"/>
                                <circle cx="50" cy="47" r="15" fill="none" stroke="white" stroke-width="2"/>
                                <rect x="25" y="15" width="50" height="20" rx="8" fill="white" opacity="0.9"/>
                                <line x1="50" y1="47" x2="50" y2="30" stroke="white" stroke-width="2"/>
                                <line x1="50" y1="47" x2="65" y2="40" stroke="white" stroke-width="2" opacity="0.7"/>
                                <line x1="50" y1="47" x2="35" y2="40" stroke="white" stroke-width="2" opacity="0.7"/>
                            </svg>
                        </div>
                        <h2>Sensor Status</h2>
                    </div>
                    <div class="card-header-right">
                        <div class="collapse-btn" onclick="toggleCard(event, 'sensor-status')">
                            <span class="collapse-icon">‚àí</span>
                        </div>
                        <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="info-row">
                        <span class="info-label">Connection</span>
                        <span class="status-badge" id="sensor-status-badge">Checking...</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">IP Address</span>
                        <span class="info-value" id="sensor-ip">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Model</span>
                        <span class="info-value" id="sensor-model">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Serial Number</span>
                        <span class="info-value" id="sensor-serial">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Firmware</span>
                        <span class="info-value" id="sensor-firmware">-</span>
                    </div>
                </div>
            </div>

            <!-- ÎìúÎùºÏù¥Î≤Ñ Ï†úÏñ¥ -->
            <div class="card" data-card-id="driver-control">
                <div class="card-header">
                    <div class="card-header-left">
                        <div class="card-icon">üöÄ</div>
                        <h2>Driver Control</h2>
                    </div>
                    <div class="card-header-right">
                        <div class="collapse-btn" onclick="toggleCard(event, 'driver-control')">
                            <span class="collapse-icon">‚àí</span>
                        </div>
                        <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    </div>
                </div>
                <div class="card-body">
                <div id="driver-status">
                    <div class="info-row">
                        <span class="info-label">Status</span>
                        <span class="status-badge" id="driver-status-badge">Stopped</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Process ID</span>
                        <span class="info-value" id="driver-pid">-</span>
                    </div>
                </div>
                <div style="margin-top: 24px; display: flex; gap: 8px;">
                    <button class="btn btn-success" id="btn-start-driver" onclick="startDriver()">Start</button>
                    <button class="btn btn-danger" id="btn-stop-driver" onclick="stopDriver()" disabled>Stop</button>
                </div>
            </div>
                </div>

            <!-- ROS2 ÌÜ†ÌîΩ -->
            <div class="card" data-card-id="topics">
                <div class="card-header">
                    <div class="card-header-left">
                        <div class="card-icon">üìä</div>
                        <h2>Active Topics</h2>
                    </div>
                    <div class="card-header-right">
                        <div class="collapse-btn" onclick="toggleCard(event, 'topics')">
                            <span class="collapse-icon">‚àí</span>
                        </div>
                        <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    </div>
                </div>
                <div class="card-body">
                <div class="progress-circle">
                    <svg width="140" height="140">
                        <defs>
                            <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#6B8DD6;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#8E37D7;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <circle class="progress-bg" cx="70" cy="70" r="60"></circle>
                        <circle class="progress-bar" cx="70" cy="70" r="60" id="topics-progress"
                            stroke-dasharray="377" stroke-dashoffset="377"></circle>
                    </svg>
                    <div class="progress-text">
                        <span class="progress-value" id="topics-count">0</span>
                        <span class="progress-label">Topics</span>
                    </div>
                </div>
                <div class="topics-list" id="topics-list">
                    <div style="color: #999; text-align: center;">No topics available</div>
                </div>
            </div>
                </div>

            <!-- ÎÖπÌôî Ï†úÏñ¥ -->
            <div class="card" data-card-id="recording">
                <div class="card-header">
                    <div class="card-header-left">
                        <div class="card-icon">‚è∫Ô∏è</div>
                        <h2>Data Recording</h2>
                    </div>
                    <div class="card-header-right">
                        <div class="collapse-btn" onclick="toggleCard(event, 'recording')">
                            <span class="collapse-icon">‚àí</span>
                        </div>
                        <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    </div>
                </div>
                <div class="card-body">
                <div id="recording-status">
                    <div class="info-row">
                        <span class="info-label">Recording Status</span>
                        <span class="status-badge" id="recording-status-badge">Standby</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Recording Time</span>
                        <span class="info-value" id="recording-time">00:00:00</span>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <input type="text" id="record-purpose" placeholder="Purpose (e.g., SLAM mapping test)">
                    <label class="checkbox-label">
                        <input type="checkbox" id="record-all">
                        <span>Record all topics</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="with-viz">
                        <span>Open RViz visualization</span>
                    </label>
                    <div style="display: flex; gap: 8px; margin-top: 12px;">
                        <button class="btn btn-warning" id="btn-start-record" onclick="startRecording()">Start Recording</button>
                        <button class="btn btn-danger" id="btn-stop-record" onclick="stopRecording()" disabled>Stop</button>
                    </div>
                </div>
            </div>
                </div>

            <!-- Ïû¨ÏÉù Ï†úÏñ¥ -->
            <div class="card" data-card-id="replay">
                <div class="card-header">
                    <div class="card-header-left">
                        <div class="card-icon">‚ñ∂Ô∏è</div>
                        <h2>Data Replay</h2>
                    </div>
                    <div class="card-header-right">
                        <div class="collapse-btn" onclick="toggleCard(event, 'replay')">
                            <span class="collapse-icon">‚àí</span>
                        </div>
                        <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    </div>
                </div>
                <div class="card-body">
                <div id="replay-status">
                    <div class="info-row">
                        <span class="info-label">Playback Status</span>
                        <span class="status-badge" id="replay-status-badge">Standby</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Process ID</span>
                        <span class="info-value" id="replay-pid">-</span>
                    </div>
                </div>
                <div style="margin-top: 24px;">
                    <p style="color: #757575; margin-bottom: 14px; font-size: 0.9em;">Select a file from the list below to play</p>
                    <button class="btn btn-danger" id="btn-stop-replay" onclick="stopReplay()" disabled>Stop Replay</button>
                </div>
            </div>
                </div>

            <!-- Ìè¨Ïù∏Ìä∏ ÌÅ¥ÎùºÏö∞Îìú Ï∫°Ï≤ò -->
            <div class="card" data-card-id="capture">
                <div class="card-header">
                    <div class="card-header-left">
                        <div class="card-icon">üì∑</div>
                        <h2>Point Cloud Capture</h2>
                    </div>
                    <div class="card-header-right">
                        <div class="collapse-btn" onclick="openCaptureSettings(event)" title="Capture Settings">
                            <span class="collapse-icon">‚öôÔ∏è</span>
                        </div>
                        <div class="collapse-btn" onclick="toggleCard(event, 'capture')">
                            <span class="collapse-icon">‚àí</span>
                        </div>
                        <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    </div>
                </div>
                <div class="card-body">
                <div class="info-row">
                    <span class="info-label">Capture Mode:</span>
                    <span class="info-value" id="capture-mode-display">Single Capture</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Capture Status:</span>
                    <span class="info-value" id="capture-status">Start driver to enable</span>
                </div>

                <button class="btn btn-primary" id="btn-capture-toggle" onclick="toggleCapture()" style="margin-top: 16px; width: 100%;">
                    üì∏ Start Capture
                </button>
                <div id="capture-result" style="margin-top: 20px;">
                    <div id="capture-loading" style="display: none; color: #6B8DD6; padding: 20px; text-align: center;">
                        Capturing... please wait
                    </div>
                    <div id="image-slider-container" style="display: none; overflow-x: auto; max-width: 100%;">
                        <div class="image-slider" style="overflow-x: auto; max-width: 100%;">
                            <img id="slider-image-top" class="slider-image active" style="max-width: none; height: auto; cursor: move;" />
                        </div>
                        <div class="slider-label" id="slider-current-label">NEAR-IR IMAGE</div>
                    </div>
                    <div id="capture-time" style="display: none; margin-top: 10px; font-size: 12px; color: #757575; text-align: center;"></div>
                </div>
            </div>
                </div>

            <!-- ÎÖπÌôî ÌååÏùº Î™©Î°ù -->
            <div class="card" data-card-id="files">
            <div class="card-header">
                    <div class="card-header-left">
                        <div class="card-icon">üìÅ</div>
                        <h2>Recorded Files</h2>
                    </div>
                    <div class="card-header-right">
                        <div class="collapse-btn" onclick="toggleCard(event, 'files')">
                            <span class="collapse-icon">‚àí</span>
                        </div>
                        <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    </div>
                </div>
                <div class="card-body">
            <div class="file-list" id="file-list">
                <div style="text-align: center; color: #999; padding: 40px;">Loading files...</div>
            </div>
        </div>
                </div>
        </div>

        <div class="auto-refresh">
            Last update: <span id="update-time">-</span> | Auto-refresh: 3s
        </div>
    </div>

    <!-- Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ Î™®Îã¨ -->
    <div id="metadataModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìù Edit Metadata</h2>
                <span class="close" onclick="closeMetadataModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="metadataForm">
                    <div class="form-section">
                        <h3>üî¨ Experiment Information</h3>
                        <div class="form-group">
                            <label for="project_name">Project Name</label>
                            <input type="text" id="project_name" name="project_name" placeholder="e.g., SLAM Mapping Test">
                        </div>
                        <div class="form-group">
                            <label for="operator">Operator</label>
                            <input type="text" id="operator" name="operator" placeholder="Enter name">
                        </div>
                        <div class="form-group">
                            <label for="purpose">Purpose</label>
                            <textarea id="purpose" name="purpose" placeholder="Describe the purpose of this recording"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="test_scenario">Test Scenario</label>
                            <textarea id="test_scenario" name="test_scenario" placeholder="Describe test scenario or conditions"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="tags">Tags (comma separated)</label>
                            <input type="text" id="tags" name="tags" placeholder="e.g., indoor, test, mapping">
                        </div>
                        <div class="form-group">
                            <label for="notes">Additional Notes</label>
                            <textarea id="notes" name="notes" placeholder="Any important notes"></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>üìç Location Information</h3>
                        <div class="form-group">
                            <label for="area_name">Area Name</label>
                            <input type="text" id="area_name" name="area_name" placeholder="e.g., Lab, Parking, Corridor">
                        </div>
                        <div class="form-group">
                            <label for="building">Building</label>
                            <input type="text" id="building" name="building" placeholder="Building name">
                        </div>
                        <div class="form-group">
                            <label for="floor">Floor</label>
                            <input type="text" id="floor" name="floor" placeholder="e.g., 3F, B1">
                        </div>
                        <div class="form-group">
                            <label for="indoor_outdoor">Indoor/Outdoor</label>
                            <select id="indoor_outdoor" name="indoor_outdoor">
                                <option value="">Select</option>
                                <option value="indoor">Indoor</option>
                                <option value="outdoor">Outdoor</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="location_description">Location Description</label>
                            <textarea id="location_description" name="location_description" placeholder="Detailed description"></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>üå§Ô∏è Environment Information</h3>
                        <div class="form-group">
                            <label for="weather_condition">Weather</label>
                            <select id="weather_condition" name="weather_condition">
                                <option value="">Select</option>
                                <option value="sunny">Sunny</option>
                                <option value="cloudy">Cloudy</option>
                                <option value="rainy">Rainy</option>
                                <option value="snowy">Snowy</option>
                                <option value="foggy">Foggy</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="temperature">Temperature (¬∞C)</label>
                            <input type="number" id="temperature" name="temperature" placeholder="e.g., 25">
                        </div>
                        <div class="form-group">
                            <label for="lighting">Lighting Condition</label>
                            <select id="lighting" name="lighting">
                                <option value="">Select</option>
                                <option value="bright">Bright</option>
                                <option value="dim">Dim</option>
                                <option value="dark">Dark</option>
                                <option value="mixed">Mixed</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="surface_type">Surface Type</label>
                            <select id="surface_type" name="surface_type">
                                <option value="">Select</option>
                                <option value="concrete">Concrete</option>
                                <option value="asphalt">Asphalt</option>
                                <option value="grass">Grass</option>
                                <option value="carpet">Carpet</option>
                                <option value="tile">Tile</option>
                                <option value="wood">Wood</option>
                            </select>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 24px; display: flex; gap: 12px; justify-content: center;">
                        <button type="button" class="btn btn-primary" onclick="saveMetadata()">üíæ Save</button>
                        <button type="button" class="btn btn-secondary" onclick="closeMetadataModal()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Ï∫°Ï≤ò ÏÑ§Ï†ï Î™®Îã¨ -->
    <div id="captureSettingsModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>‚öôÔ∏è Capture Settings</h2>
                <span class="close" onclick="closeCaptureSettings()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-section">
                    <div class="form-group">
                        <label for="capture-mode-modal">Capture Mode</label>
                        <select id="capture-mode-modal">
                            <option value="single">Single Capture</option>
                            <option value="auto">Auto Capture (Repeat)</option>
                        </select>
                    </div>

                    <div id="interval-setting-modal" style="display: none;">
                        <div class="form-group">
                            <label for="capture-interval-modal">Interval (seconds)</label>
                            <input type="number" id="capture-interval-modal" placeholder="e.g., 5" min="1" max="60" value="5">
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 24px; display: flex; gap: 12px; justify-content: center;">
                    <button type="button" class="btn btn-primary" onclick="saveCaptureSettings()">üíæ Save</button>
                    <button type="button" class="btn btn-secondary" onclick="closeCaptureSettings()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <div id="message"></div>

    <script>
        let updateInterval;
        let currentBagName = null;
        let recordingStartTime = null;
        let recordingTimerInterval = null;

        function showMessage(text, isSuccess = true) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = isSuccess ? 'success' : 'error';
            msg.style.display = 'block';
            setTimeout(() => {
                msg.style.display = 'none';
            }, 3000);
        }

        async function updateStatus() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();

                // ÏÑºÏÑú ÏÉÅÌÉú
                const sensor = data.sensor;
                document.getElementById('sensor-status-badge').textContent = sensor.status === 'online' ? 'Online' : 'Offline';
                document.getElementById('sensor-status-badge').className = `status-badge status-${sensor.status}`;
                document.getElementById('sensor-ip').textContent = sensor.ip;
                document.getElementById('sensor-model').textContent = sensor.model;
                document.getElementById('sensor-serial').textContent = sensor.serial;
                document.getElementById('sensor-firmware').textContent = sensor.firmware;

                // ÎìúÎùºÏù¥Î≤Ñ ÏÉÅÌÉú
                const driver = data.driver;
                document.getElementById('driver-status-badge').textContent = driver.active ? 'Running' : 'Stopped';
                document.getElementById('driver-status-badge').className = `status-badge ${driver.active ? 'status-online' : 'status-offline'}`;
                document.getElementById('driver-pid').textContent = driver.pid || '-';
                document.getElementById('btn-start-driver').disabled = driver.active;
                document.getElementById('btn-stop-driver').disabled = !driver.active;

                // ROS2 ÌÜ†ÌîΩ (ÏõêÌòï ÌîÑÎ°úÍ∑∏Î†àÏä§)
                const topics = data.ros_topics;
                const topicCount = topics.count;
                const maxTopics = 12; // ÏµúÎåÄ ÌÜ†ÌîΩ Ïàò (Ï°∞Ï†ï Í∞ÄÎä•)
                const percentage = Math.min((topicCount / maxTopics) * 100, 100);
                const circumference = 377;
                const offset = circumference - (circumference * percentage / 100);

                document.getElementById('topics-count').textContent = topicCount;
                document.getElementById('topics-progress').style.strokeDashoffset = offset;

                const topicsList = document.getElementById('topics-list');
                if (topics.topics.length > 0) {
                    topicsList.innerHTML = topics.topics.map(t => `<div>${t}</div>`).join('');
                } else {
                    topicsList.innerHTML = '<div style="color: #999; text-align: center;">No topics available</div>';
                }

                // ÎÖπÌôî ÏÉÅÌÉú
                const recording = data.recording;
                document.getElementById('recording-status-badge').textContent = recording.active ? 'Recording' : 'Standby';
                document.getElementById('recording-status-badge').className = `status-badge ${recording.active ? 'status-recording' : ''}`;
                document.getElementById('btn-start-record').disabled = recording.active;
                document.getElementById('btn-stop-record').disabled = !recording.active;

                // ÎÖπÌôî ÌÉÄÏù¥Î®∏ Í¥ÄÎ¶¨
                if (recording.active && !recordingStartTime) {
                    recordingStartTime = new Date();
                    startRecordingTimer();
                } else if (!recording.active && recordingStartTime) {
                    recordingStartTime = null;
                    stopRecordingTimer();
                    document.getElementById('recording-time').textContent = '00:00:00';
                }

                // Ï∫°Ï≤ò ÏÉÅÌÉú - ÌÜ†ÌîΩÏù¥ ÏûàÏúºÎ©¥ Ï∫°Ï≤ò Í∞ÄÎä•
                const captureBtn = document.getElementById('btn-capture-toggle');
                const captureStatus = document.getElementById('capture-status');
                if (captureBtn && captureStatus) {
                    if (topics.available && topics.count > 0) {
                        captureBtn.disabled = false;
                        captureStatus.textContent = 'Ready to capture';
                        captureStatus.style.color = '#43A047';
                    } else {
                        captureBtn.disabled = true;
                        captureStatus.textContent = 'Start driver to enable';
                        captureStatus.style.color = '#999';
                    }
                }

                // Ïû¨ÏÉù ÏÉÅÌÉú
                const replay = data.replay;
                document.getElementById('replay-status-badge').textContent = replay.active ? 'Playing' : 'Standby';
                document.getElementById('replay-status-badge').className = `status-badge ${replay.active ? 'status-online' : ''}`;
                document.getElementById('replay-pid').textContent = replay.pid || '-';
                document.getElementById('btn-stop-replay').disabled = !replay.active;

                // ÌååÏùº Î™©Î°ù
                const files = data.files;
                const fileList = document.getElementById('file-list');
                if (files.length > 0) {
                    fileList.innerHTML = files.map(file => `
                        <div class="file-item">
                            <div class="file-name">${file.name}</div>
                            <div class="file-info">Size: ${file.size}</div>
                            <div class="file-info">Duration: ${file.duration}</div>
                            <div class="file-info">Created: ${file.created}</div>
                            <div class="file-actions">
                                <button class="btn btn-primary" onclick="startReplay('${file.path}')">‚ñ∂Ô∏è Play</button>
                                <button class="btn btn-info" onclick="editMetadata('${file.name}')">üìù Metadata</button>
                                <button class="btn btn-danger" onclick="deleteFile('${file.path}')">üóëÔ∏è Delete</button>
                            </div>
                        </div>
                    `).join('');
                } else {
                    fileList.innerHTML = '<div style="text-align: center; color: #999; padding: 40px;">No recorded files</div>';
                }

                // ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏
                const now = new Date();
                document.getElementById('last-update').textContent = now.toLocaleTimeString('en-US', {hour: '2-digit', minute:'2-digit'});
                document.getElementById('update-time').textContent = now.toLocaleTimeString('ko-KR');

            } catch (error) {
                console.error('Status update failed:', error);
            }
        }

        async function startDriver() {
            try {
                const response = await fetch('/api/driver/start', { method: 'POST' });
                const data = await response.json();
                showMessage(data.message, data.success);
                if (data.success) updateStatus();
            } catch (error) {
                showMessage('Failed to start driver', false);
            }
        }

        async function stopDriver() {
            try {
                const response = await fetch('/api/driver/stop', { method: 'POST' });
                const data = await response.json();
                showMessage(data.message, data.success);
                if (data.success) updateStatus();
            } catch (error) {
                showMessage('Failed to stop driver', false);
            }
        }

        function startRecordingTimer() {
            if (recordingTimerInterval) {
                clearInterval(recordingTimerInterval);
            }

            recordingTimerInterval = setInterval(() => {
                if (recordingStartTime) {
                    const elapsed = Math.floor((new Date() - recordingStartTime) / 1000);
                    const hours = String(Math.floor(elapsed / 3600)).padStart(2, '0');
                    const minutes = String(Math.floor((elapsed % 3600) / 60)).padStart(2, '0');
                    const seconds = String(elapsed % 60).padStart(2, '0');
                    document.getElementById('recording-time').textContent = `${hours}:${minutes}:${seconds}`;
                }
            }, 1000);
        }

        function stopRecordingTimer() {
            if (recordingTimerInterval) {
                clearInterval(recordingTimerInterval);
                recordingTimerInterval = null;
            }
        }

        async function startRecording() {
            try {
                const purpose = document.getElementById('record-purpose').value;
                const recordAll = document.getElementById('record-all').checked;
                const withViz = document.getElementById('with-viz').checked;

                const response = await fetch('/api/record/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        filename: '',  // ÏûêÎèô ÏÉùÏÑ±
                        duration: '',  // Î¨¥Ï†úÌïú
                        purpose,
                        record_all: recordAll,
                        with_viz: withViz
                    })
                });
                const data = await response.json();
                showMessage(data.message, data.success);
                if (data.success) {
                    recordingStartTime = new Date();
                    startRecordingTimer();
                    updateStatus();
                }
            } catch (error) {
                showMessage('Failed to start recording', false);
            }
        }

        async function stopRecording() {
            try {
                const response = await fetch('/api/record/stop', { method: 'POST' });
                const data = await response.json();
                showMessage(data.message, data.success);
                if (data.success) {
                    recordingStartTime = null;
                    stopRecordingTimer();
                    document.getElementById('recording-time').textContent = '00:00:00';
                    updateStatus();
                }
            } catch (error) {
                showMessage('Failed to stop recording', false);
            }
        }

        async function startReplay(bagPath) {
            const fileName = bagPath.split('/').pop();
            const useRviz = confirm(`${fileName} replay options:\n\nDo you want to launch RViz?\n\n[OK]: Play with RViz\n[Cancel]: Play only (no RViz)`);

            try {
                const response = await fetch('/api/replay/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        bag_path: bagPath,
                        use_rviz: useRviz,
                        loop: false
                    })
                });
                const data = await response.json();

                let message = data.message;
                if (data.success && data.options) {
                    message += ` (${data.options.rviz ? 'with RViz' : 'no RViz'})`;
                }

                showMessage(message, data.success);
                if (data.success) updateStatus();
            } catch (error) {
                showMessage('Failed to start replay', false);
            }
        }

        async function stopReplay() {
            try {
                const response = await fetch('/api/replay/stop', { method: 'POST' });
                const data = await response.json();
                showMessage(data.message, data.success);
                if (data.success) updateStatus();
            } catch (error) {
                showMessage('Failed to stop replay', false);
            }
        }

        async function deleteFile(bagPath) {
            if (!confirm('Are you sure you want to delete this file?')) return;

            try {
                const response = await fetch('/api/files/delete', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ bag_path: bagPath })
                });
                const data = await response.json();
                showMessage(data.message, data.success);
                if (data.success) updateStatus();
            } catch (error) {
                showMessage('Failed to delete file', false);
            }
        }

        async function editMetadata(bagName) {
            currentBagName = bagName;

            try {
                const response = await fetch(`/api/metadata/${bagName}`);
                const data = await response.json();

                if (data.success) {
                    const metadata = data.metadata;

                    document.getElementById('project_name').value = metadata.experiment?.project_name || '';
                    document.getElementById('operator').value = metadata.experiment?.operator || '';
                    document.getElementById('purpose').value = metadata.experiment?.purpose || '';
                    document.getElementById('test_scenario').value = metadata.experiment?.test_scenario || '';
                    document.getElementById('tags').value = metadata.experiment?.tags?.join(', ') || '';
                    document.getElementById('notes').value = metadata.experiment?.notes || '';

                    document.getElementById('area_name').value = metadata.location?.area_name || '';
                    document.getElementById('building').value = metadata.location?.building || '';
                    document.getElementById('floor').value = metadata.location?.floor || '';
                    document.getElementById('indoor_outdoor').value = metadata.location?.indoor_outdoor || '';
                    document.getElementById('location_description').value = metadata.location?.description || '';

                    document.getElementById('weather_condition').value = metadata.environment?.weather?.condition || '';
                    document.getElementById('temperature').value = metadata.environment?.weather?.temperature || '';
                    document.getElementById('lighting').value = metadata.environment?.lighting || '';
                    document.getElementById('surface_type').value = metadata.environment?.surface_type || '';
                }

                document.getElementById('metadataModal').style.display = 'block';

            } catch (error) {
                console.error('Failed to load metadata:', error);
                document.getElementById('metadataModal').style.display = 'block';
            }
        }

        function closeMetadataModal() {
            document.getElementById('metadataModal').style.display = 'none';
            document.getElementById('metadataForm').reset();
            currentBagName = null;
        }

        async function saveMetadata() {
            if (!currentBagName) {
                showMessage('No bag file selected', false);
                return;
            }

            const formData = {
                experiment: {
                    project_name: document.getElementById('project_name').value,
                    operator: document.getElementById('operator').value,
                    purpose: document.getElementById('purpose').value,
                    test_scenario: document.getElementById('test_scenario').value,
                    notes: document.getElementById('notes').value,
                    tags: document.getElementById('tags').value.split(',').map(tag => tag.trim()).filter(tag => tag)
                },
                location: {
                    area_name: document.getElementById('area_name').value,
                    building: document.getElementById('building').value,
                    floor: document.getElementById('floor').value,
                    indoor_outdoor: document.getElementById('indoor_outdoor').value,
                    description: document.getElementById('location_description').value
                },
                environment: {
                    weather: {
                        condition: document.getElementById('weather_condition').value,
                        temperature: document.getElementById('temperature').value ? parseFloat(document.getElementById('temperature').value) : null
                    },
                    lighting: document.getElementById('lighting').value,
                    surface_type: document.getElementById('surface_type').value
                }
            };

            try {
                const response = await fetch(`/api/metadata/${currentBagName}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();
                showMessage(data.message, data.success);

                if (data.success) {
                    closeMetadataModal();
                }
            } catch (error) {
                console.error('Failed to save metadata:', error);
                showMessage('Failed to save metadata', false);
            }
        }

        window.onclick = function(event) {
            const modal = document.getElementById('metadataModal');
            if (event.target == modal) {
                closeMetadataModal();
            }
        }

        let currentSlide = 0;
        const slideLabels = ['TOP VIEW', 'LEFT VIEW', 'RIGHT VIEW'];
        let autoCaptureInterval = null;
        let isAutoCapturing = false;

        function showSlide(index) {
            const images = document.querySelectorAll('.slider-image');
            const dots = document.querySelectorAll('.slider-dot');

            images.forEach((img, i) => {
                img.classList.toggle('active', i === index);
            });

            dots.forEach((dot, i) => {
                dot.classList.toggle('active', i === index);
            });

            document.getElementById('slider-current-label').textContent = slideLabels[index];
            currentSlide = index;

            // Update button states
            document.getElementById('slider-prev').disabled = (index === 0);
            document.getElementById('slider-next').disabled = (index === images.length - 1);
        }

        function nextSlide() {
            const images = document.querySelectorAll('.slider-image');
            if (currentSlide < images.length - 1) {
                showSlide(currentSlide + 1);
            }
        }

        function previousSlide() {
            if (currentSlide > 0) {
                showSlide(currentSlide - 1);
            }
        }

        function goToSlide(index) {
            showSlide(index);
        }

        async function capturePointCloud() {
            try {
                if (!isAutoCapturing) {
                    document.getElementById('capture-loading').style.display = 'block';
                    const captureBtn = document.getElementById('btn-capture-toggle');
                    if (captureBtn) captureBtn.disabled = true;
                }
                // Í∏∞Ï°¥ Ïù¥ÎØ∏ÏßÄÎäî Ïú†ÏßÄÌïòÍ≥† Î°úÎî©Îßå ÌëúÏãú
                // document.getElementById('image-slider-container').style.display = 'none';

                const response = await fetch('/api/capture');
                const data = await response.json();

                if (data.success && data.image) {
                    // Set single Near-IR image
                    const imgElement = document.getElementById('slider-image-top');
                    if (imgElement) {
                        imgElement.src = data.image;
                    }

                    // Show image container
                    const containerElement = document.getElementById('image-slider-container');
                    if (containerElement) {
                        containerElement.style.display = 'block';
                    }
                    showSlide(0);

                    if (data.timestamp) {
                        document.getElementById('capture-time').textContent = `Captured: ${data.timestamp}`;
                        document.getElementById('capture-time').style.display = 'block';
                    }

                    if (!isAutoCapturing) {
                        showMessage(data.message, true);
                    }
                } else {
                    if (!isAutoCapturing) {
                        showMessage(data.message || 'Capture failed', false);
                    }
                }
            } catch (error) {
                if (!isAutoCapturing) {
                    showMessage('Capture failed: ' + error.message, false);
                }
            } finally {
                document.getElementById('capture-loading').style.display = 'none';
                if (!isAutoCapturing) {
                    const captureBtn = document.getElementById('btn-capture-toggle');
                    if (captureBtn) captureBtn.disabled = false;
                }
            }
        }


        // Capture settings
        let captureMode = 'single';
        let captureInterval = 5;

        function openCaptureSettings(event) {
            event.stopPropagation();

            // Load current settings
            document.getElementById('capture-mode-modal').value = captureMode;
            document.getElementById('capture-interval-modal').value = captureInterval;

            // Show/hide interval setting
            const intervalSetting = document.getElementById('interval-setting-modal');
            if (captureMode === 'auto') {
                intervalSetting.style.display = 'block';
            } else {
                intervalSetting.style.display = 'none';
            }

            document.getElementById('captureSettingsModal').style.display = 'block';
        }

        function closeCaptureSettings() {
            document.getElementById('captureSettingsModal').style.display = 'none';
        }

        function saveCaptureSettings() {
            captureMode = document.getElementById('capture-mode-modal').value;
            captureInterval = parseInt(document.getElementById('capture-interval-modal').value);

            // Update display
            const displayText = captureMode === 'single' ? 'Single Capture' : `Auto Capture (${captureInterval}s)`;
            document.getElementById('capture-mode-display').textContent = displayText;

            closeCaptureSettings();
            showMessage('Capture settings saved', true);
        }

        // Capture mode Î≥ÄÍ≤Ω Ïãú interval ÏÑ§Ï†ï ÌëúÏãú/Ïà®ÍπÄ
        document.addEventListener('DOMContentLoaded', function() {
            const captureModeModal = document.getElementById('capture-mode-modal');
            if (captureModeModal) {
                captureModeModal.addEventListener('change', function() {
                    const intervalSetting = document.getElementById('interval-setting-modal');
                    if (this.value === 'auto') {
                        intervalSetting.style.display = 'block';
                    } else {
                        intervalSetting.style.display = 'none';
                    }
                });
            }
        });

        function toggleCapture() {
            const btn = document.getElementById('btn-capture-toggle');

            if (!isAutoCapturing) {
                // Start capture
                if (captureMode === 'single') {
                    // Single capture
                    capturePointCloud();
                } else {
                    // Auto capture
                    if (!captureInterval || captureInterval < 1 || captureInterval > 60) {
                        showMessage('Please set a valid interval (1-60 seconds) in settings', false);
                        return;
                    }

                    isAutoCapturing = true;
                    btn.textContent = '‚èπÔ∏è Stop Capture';
                    btn.classList.remove('btn-primary');
                    btn.classList.add('btn-danger');

                    // First capture immediately
                    capturePointCloud();

                    // Then set interval
                    autoCaptureInterval = setInterval(() => {
                        capturePointCloud();
                    }, captureInterval * 1000);

                    showMessage(`Auto capture started (every ${captureInterval}s)`, true);
                }
            } else {
                // Stop auto capture
                if (autoCaptureInterval) {
                    clearInterval(autoCaptureInterval);
                    autoCaptureInterval = null;
                }

                isAutoCapturing = false;
                btn.textContent = 'üì∏ Start Capture';
                btn.classList.remove('btn-danger');
                btn.classList.add('btn-primary');

                showMessage('Auto capture stopped', true);
            }
        }

        // Ïπ¥Îìú Ï†ëÍ∏∞/ÌéºÏπòÍ∏∞
        function toggleCard(event, cardId) {
            event.stopPropagation();
            const card = document.querySelector(`[data-card-id="${cardId}"]`);
            const icon = card.querySelector('.collapse-icon');

            card.classList.toggle('collapsed');
            icon.textContent = card.classList.contains('collapsed') ? '+' : '‚àí';

            saveCardStates();
        }

        // Ïπ¥Îìú ÏÉÅÌÉú Ï†ÄÏû•
        function saveCardStates() {
            const cards = document.querySelectorAll('.card');
            const states = {};
            cards.forEach(card => {
                const cardId = card.getAttribute('data-card-id');
                states[cardId] = {
                    collapsed: card.classList.contains('collapsed')
                };
            });
            localStorage.setItem('cardStates', JSON.stringify(states));
        }

        // Ïπ¥Îìú ÏÉÅÌÉú Î≥µÏõê
        function restoreCardStates() {
            const savedStates = localStorage.getItem('cardStates');
            if (!savedStates) return;

            const states = JSON.parse(savedStates);
            Object.keys(states).forEach(cardId => {
                const card = document.querySelector(`[data-card-id="${cardId}"]`);
                if (card && states[cardId].collapsed) {
                    card.classList.add('collapsed');
                    const icon = card.querySelector('.collapse-icon');
                    if (icon) icon.textContent = '+';
                }
            });
        }

        // Ïπ¥Îìú ÏàúÏÑú Ï†ÄÏû•
        function saveCardOrder() {
            const grid = document.getElementById('dashboard-grid');
            const cards = grid.querySelectorAll('.card');
            const order = Array.from(cards).map(card => card.getAttribute('data-card-id'));
            localStorage.setItem('cardOrder', JSON.stringify(order));
            console.log('Card order saved:', order);
        }

        // Ïπ¥Îìú ÏàúÏÑú Î≥µÏõê
        function restoreCardOrder() {
            const savedOrder = localStorage.getItem('cardOrder');
            if (!savedOrder) return;

            const order = JSON.parse(savedOrder);
            const grid = document.getElementById('dashboard-grid');
            const cards = {};

            // Î™®Îì† Ïπ¥ÎìúÎ•º Í∞ùÏ≤¥Ïóê Ï†ÄÏû•
            document.querySelectorAll('.card').forEach(card => {
                const cardId = card.getAttribute('data-card-id');
                if (cardId) {
                    cards[cardId] = card;
                }
            });

            // Ï†ÄÏû•Îêú ÏàúÏÑúÎåÄÎ°ú Ïû¨Î∞∞Ïπò
            order.forEach(cardId => {
                if (cards[cardId]) {
                    grid.appendChild(cards[cardId]);
                }
            });

            console.log('Card order restored:', order);
        }

        // Sortable Ï¥àÍ∏∞Ìôî
        function initSortable() {
            const grid = document.getElementById('dashboard-grid');
            new Sortable(grid, {
                animation: 200,
                handle: '.drag-handle',
                ghostClass: 'sortable-ghost',
                dragClass: 'sortable-drag',
                onEnd: function() {
                    saveCardOrder();
                }
            });
        }

        // Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            restoreCardOrder();
            restoreCardStates();
            initSortable();
        });

        updateStatus();
        updateInterval = setInterval(updateStatus, 3000);
    </script>
</body>
</html>
